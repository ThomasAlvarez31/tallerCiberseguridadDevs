<!DOCTYPE html>
<html>
<head>
    <title>P√°gina Vulnerable</title>
    <style>
        .vulnerable { background: #ffe6e6; padding: 10px; margin: 10px; border: 2px solid red; }
        .secure { background: #e6ffe6; padding: 10px; margin: 10px; border: 2px solid green; }
        button { margin: 5px; padding: 8px; }
        input { margin: 5px; padding: 5px; width: 300px; }
        .result { min-height: 50px; border: 1px dashed #ccc; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üö® Demostraci√≥n de Vulnerabilidades</h1>

    <!-- üî¥ VULNERABILIDAD 1: XSS B√°sico -->
    <div class="vulnerable">
        <h2>üî¥ 1. Ataque XSS (Cross-Site Scripting)</h2>
        <p>Escribe algo que se mostrar√° en la p√°gina:</p>
        <input type="text" id="userInput" placeholder='Escribe: <img src="x" onerror="alert("XSS!")">'>
        <button onclick="mostrarVulnerable()">Mostrar (VULNERABLE - innerHTML)</button>
        <button onclick="mostrarSeguro()">Mostrar (SEGURO - textContent)</button>
        <div id="resultado" class="result"></div>
    </div>

    <!-- üî¥ VULNERABILIDAD 2: SQL Injection Simulada -->
    <div class="vulnerable">
        <h2>üî¥ 2. SQL Injection Simulada</h2>
        <p>Base de datos simulada: usuarios = ["admin", "usuario1", "pedro"]</p>
        <input type="text" id="usuario" placeholder='Escribe: admin" OR "1"="1'>
        <button onclick="validarDebil()">Validar (VULNERABLE a SQLi)</button>
        <button onclick="validarFuerte()">Validar (SEGURO contra SQLi)</button>
        <div id="mensaje" class="result"></div>
    </div>

    <!-- üî¥ VULNERABILIDAD 3: Eval Peligroso -->
    <div class="vulnerable">
        <h2>üî¥ 3. Ejecuci√≥n de C√≥digo Peligrosa</h2>
        <p>Escribe una operaci√≥n matem√°tica o c√≥digo malicioso:</p>
        <input type="text" id="operacion" placeholder='Escribe: alert("Peligro!"); 2+2'>
        <button onclick="calcularPeligroso()">Calcular (PELIGROSO - usa eval())</button>
        <button onclick="calcularSeguro()">Calcular (SEGURO - validaci√≥n)</button>
        <div id="calculadora" class="result"></div>
    </div>

    <script>
        // Base de datos simulada para SQL Injection
        const usuariosSimulados = ["admin", "usuario1", "pedro"];
        const contrasenasSimuladas = {
            "admin": "123456",
            "usuario1": "password123", 
            "pedro": "miContrase√±a"
        };

        // üî¥ VULNERABILIDAD 1: XSS - innerHTML peligroso
        function mostrarVulnerable() {
            const input = document.getElementById('userInput').value;
            // ¬°PELIGRO! Usar innerHTML permite ejecutar c√≥digo
            document.getElementById('resultado').innerHTML = 
                "<strong>T√∫ escribiste:</strong> " + input;
            
            mostrarExplicacion('XSS', 
                '‚ùå Usando innerHTML, el c√≥digo JavaScript se ejecuta. ' +
                'Esto permite robar cookies, redirigir usuarios, etc.');
        }

        // ‚úÖ VERSI√ìN SEGURA
        function mostrarSeguro() {
            const input = document.getElementById('userInput').value;
            // ¬°SEGURO! textContent no ejecuta c√≥digo
            document.getElementById('resultado').textContent = 
                "T√∫ escribiste: " + input;
            
            mostrarExplicacion('XSS', 
                '‚úÖ Usando textContent, el c√≥digo se muestra como texto ' +
                'y no se ejecuta. ¬°Esto es seguro!');
        }

        // üî¥ VULNERABILIDAD 2: SQL Injection Simulada
        function validarDebil() {
            const usuario = document.getElementById('usuario').value;
            
            // SIMULACI√ìN de consulta SQL vulnerable
            // En una app real ser√≠a: "SELECT * FROM users WHERE username = '" + usuario + "'"
            const consultaSimulada = `Buscar usuario: ${usuario}`;
            
            // Validaci√≥n vulnerable que simula SQL Injection
            let accesoConcedido = false;
            
            // ¬°VULNERABLE! Concatenaci√≥n directa en la "consulta"
            if (usuario.includes('" OR "1"="1') || usuario.includes("' OR '1'='1")) {
                accesoConcedido = true; // SQL Injection exitoso
                document.getElementById('mensaje').innerHTML = 
                    "üîì <strong>ACCESO CONCEDIDO</strong> - SQL Injection funcion√≥!<br>" +
                    "Consulta simulada: SELECT * FROM users WHERE username = '" + usuario + "'<br>" +
                    "Resultado: Se devolvieron TODOS los usuarios";
            } else if (usuariosSimulados.includes(usuario.replace(/["']/g, ''))) {
                accesoConcedido = true;
                document.getElementById('mensaje').innerHTML = 
                    "‚úÖ Acceso concedido para usuario v√°lido";
            } else {
                document.getElementById('mensaje').innerHTML = 
                    "‚ùå Acceso denegado - Usuario no encontrado";
            }
            
            mostrarExplicacion('SQL Injection',
                '‚ùå La entrada del usuario se concatena directamente en la consulta. ' +
                'El atacante puede modificar la l√≥gica SQL con: <code>admin" OR "1"="1</code>');
        }

        // ‚úÖ VERSI√ìN SEGURA contra SQL Injection
        function validarFuerte() {
            const usuario = document.getElementById('usuario').value;
            
            // Validaci√≥n segura - consulta parametrizada simulada
            const usuarioLimpio = usuario.replace(/["';]/g, ''); // Limpiar caracteres peligrosos
            
            if (usuariosSimulados.includes(usuarioLimpio)) {
                document.getElementById('mensaje').innerHTML = 
                    "‚úÖ Acceso concedido (validaci√≥n segura)";
            } else {
                document.getElementById('mensaje').innerHTML = 
                    "‚ùå Acceso denegado - Usuario no v√°lido<br>" +
                    "Consulta segura: SELECT * FROM users WHERE username = ? [par√°metro: " + usuarioLimpio + "]";
            }
            
            mostrarExplicacion('SQL Injection',
                '‚úÖ Usando consultas parametrizadas, la entrada del usuario ' +
                'se trata como DATA, no como C√ìDIGO. ¬°SQL Injection bloqueado!');
        }

        // üî¥ VULNERABILIDAD 3: eval() es PELIGROSO
        function calcularPeligroso() {
            const operacion = document.getElementById('operacion').value;
            try {
                // ¬°PELIGRO! eval ejecuta CUALQUIER c√≥digo JavaScript
                const resultado = eval(operacion);
                document.getElementById('calculadora').innerHTML = 
                    "üîì <strong>Resultado (PELIGROSO):</strong> " + resultado + 
                    "<br>¬°Cuidado! Se ejecut√≥ todo el c√≥digo JavaScript";
            } catch (error) {
                document.getElementById('calculadora').innerHTML = 
                    "Error: " + error.message;
            }
            
            mostrarExplicacion('eval() peligroso',
                '‚ùå eval() ejecuta CUALQUIER c√≥digo JavaScript. ' +
                'Puede borrar datos, redirigir usuarios, etc.');
        }

        // ‚úÖ VERSI√ìN SEGURA
        function calcularSeguro() {
            const operacion = document.getElementById('operacion').value;
            
            // Solo permitir n√∫meros y operadores matem√°ticos
            if (!/^[0-9+\-*/().\s]+$/.test(operacion)) {
                document.getElementById('calculadora').innerHTML = 
                    "‚ùå <strong>Bloqueado por seguridad:</strong> Solo se permiten n√∫meros y + - * / ( )";
                return;
            }
            
            try {
                // M√©todo m√°s seguro que eval
                const resultado = Function('"use strict"; return (' + operacion + ')')();
                document.getElementById('calculadora').innerHTML = 
                    "‚úÖ <strong>Resultado seguro:</strong> " + resultado;
            } catch (error) {
                document.getElementById('calculadora').innerHTML = 
                    "Error en la operaci√≥n matem√°tica";
            }
            
            mostrarExplicacion('eval() seguro',
                '‚úÖ Validamos que solo contenga caracteres matem√°ticos. ' +
                '¬°C√≥digo malicioso bloqueado!');
        }

        function mostrarExplicacion(tipo, mensaje) {
            console.log(`üîç ${tipo}: ${mensaje}`);
        }
    </script>

    <!-- üéØ INSTRUCCIONES DE DEMOSTRACI√ìN -->
    <div class="secure">
        <h2>üéØ INSTRUCCIONES PARA DEMOSTRAR</h2>
        
        <h3>1. XSS - Cross Site Scripting</h3>
        <p><strong>Escribe esto:</strong> <code>&lt;img src="x" onerror="alert('XSS Funciona!')"&gt;</code></p>
        <p>Luego haz clic en <strong>"Mostrar (VULNERABLE)"</strong> - ¬°Se ejecutar√° el alert!</p>
        
        <h3>2. SQL Injection</h3>
        <p><strong>Escribe esto:</strong> <code>admin" OR "1"="1</code></p>
        <p>Luego haz clic en <strong>"Validar (VULNERABLE a SQLi)"</strong> - ¬°Acceso concedido!</p>
        
        <h3>3. Ejecuci√≥n de C√≥digo</h3>
        <p><strong>Escribe esto:</strong> <code>alert('C√≥digo Peligroso!'); 2+2</code></p>
        <p>Luego haz clic en <strong>"Calcular (PELIGROSO)"</strong> - ¬°Se ejecuta el alert y el c√°lculo!</p>
    </div>
</body>
</html>